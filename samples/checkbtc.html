<!DOCTYPE html>
<html><head>
<meta charset="UTF-8">	
<title>checked btc input</title>
<style>
*{box-sizing:border-box;}
body{}

#tableBtcAmount{
/*color:blue;*/
ackground:red;
/*box-shadow:0 0 0 3px lime;*/
/*border-bottom:4px solid green;*/
border-collapse:collapse;
}
#wraptable{
width:25%;	
ackground:red;
border:1px solid gray;
display:block;
height:50px;
position:relative;
/*  top bottom  right left
box-shadow: 0 1px gray inset,0 -1px gray inset, -1px 0 gray inset, 1px 0 gray inset;
*/
transition:border-color 0.1s, box-shadow 3s;	

}
#wraptable.focus{
/*box-shadow:0 0 0 3px lime;*/
box-shadow: 0 1px lightblue inset,0 -1px lightblue inset, -1px 0 lightblue inset, 1px 0 lightblue inset;
border-color:lightblue;
}

#dropBtc{
position:absolute;
background:transparent;
display: none;
z-index:1;
margin-top:3px;
height:auto;
width:24.6%;
width:calc(25% - 13px);	
border:1px solid transparent;
}

.btclab{
display:block;
position:relative;
/*border:2px solid black;*/
margin-top:3px;
text-align:center;
color:green;
}

.keypad-lbl, .keypadBackspace, .keypadReset{
display:inline-block;
border:1px solid black;	
height:56px;
font-size:20px;
margin-top:2px;
margin-bottom:2px;
padding-top:13px;
cursor:pointer;
}

.keypad-lbl{
width:52px;
}
.keypadReset,.keypadBackspace{
width:108px;
}


.keypadBackspace.act{
color:orange;
border-color:blue;	
box-shadow:0 0 0 3px lime;	
}
.keypadReset.act{
color:blue;
border-color:blue;	
}

.keypad-lbl.act-key{
color:brown;
border-color:yellow;
}


#dropBtc::selection,.keypad-lbl::selection,#spanout::selection,label[for=dropcheck]::selection, 
.keypadReset::selection, .keypadBackspace::selection, .btclab::selection, button::selection{background:none;}

#tableBtcAmount td{

border-top:none;
border-left:none;
border-right:none;
overflow:hidden;
hight:25px;
font-size:21px;
text-align:center;
font-weight:bold;
margin:0;
padding:0;
}

label[for="dropcheck"]{
olor:red;
cursor:pointer;
ackground:pink;
order:1px solid brown;
height:auto;
}


td::after{
content:"";
background:rgba(0,190,0,0.4);

display:block;
width:0%;
height:1px;
opacity:0.0;
transition: width 0.8s, opacity 0.8s;	
}

td.wboo::after{
width:100%;
opacity:1.0;
}


td div{
display:block;
ackground:lightblue;
width:12px;
height:24px;
transform:translateY(29px);
}
td div.boo{
animation-name:example;
animation-duration:0.1s;
animation-duration-count:1;
animation-fill-mode:both;	
}



@keyframes example{
0%{transform:translateY(29px);}
25%{transform:translateY(-29px);}
50%{transform:translateY(10px);}
75%{transform:translateY(-10px);}
100%{transform:translateY(0);}
}


@keyframes example2{

0%{transform:translateY(0);}
25%{transform:translateY(-4px);}
50%{transform:translateY(8px);}
75%{transform:translateY(4px);}
100%{transform:translateY(-29px);}
}

td div.boo.pissoff{
color:red;
animation-name:example2;
animation-duration:0.1s;
animation-duration-count:1;
animation-fill-mode:backwards;
}


@keyframes kursi{



from{opacity:1;}
to{opacity:0;}

}

#cursi{
position:absolute;
display: none;
top:4px;
left:0px;
visibility:visible;
background:green;
border:1px solid transparent;
border-radius:50%;
width:0px;
height:40px;
animation-name:kursi;
animation-duration:1s;
/*animation-direction:alternate-reverse;*/
animation-iteration-count:infinite;
}

#placeholdi{
position:absolute;
display:block;
top:15px;left:3px;
ackground:violet;	
color:rgba(10,10,15,0.6);
}
#placeholdi.empty{
display:none;	
}

.treg-down{
display:block;
position:absolute;
width:0;
height:0;
right:20px;
top:18px;

border-left:18px solid transparent;
border-right:18px solid transparent;
border-top:18px solid rgba(100,100,12,1.0);
transition: all .9s;
}

.treg-down.act{
/*transform: rotate(180deg);
transform-origin:50% 50%;
*/
}
.keypadInfo{background:pink;}



@media screen and (max-width:890px){
body{background:inherit;}
#wraptable{width:100%;}
#dropBtc{
width:97.5%;
width:calc(100% - 48px);
}
.keypad-lbl,.keypadReset,.keypadBackspace{
width:85px;height:75px;
padding:20px;
font-size:24px;
}
.keypadReset,.keypadBackspace{
width:130px;
}

}
</style>
</head>
<body>
<button onclick="bibka();">bibka</button> | <button onclick="check_transform();">check transform</button><br><br>
<form id="foget" action="/foo" method="get" name="dooo">
<fieldset><legend>choose</legend>
<b>btc_minimum = 0.0263</b>&nbsp;&nbsp;<b>btc_maximum = 300</b><br><br>
<label for="dropcheck"><input id="dropcheck" type="checkbox" hidden value="7"  onchange="nu(this);"/><span><b>your btc amount:</b></span>
<div id="wraptable" style="">
<div id="cursi" style=""></div>
<div id="placeholdi">0.05 (BTC)</div>
<table id="tableBtcAmount" style="ackground:brown;margin-top:12px;margin-left:0px;" name="suka" value="fffidi">
	
<!-- <caption id="captEl" style="background:pink;margin-bottom: 1px;">0.05</caption> -->
<!-- [1 - 8] -->
<!-- <thead><tr><th colspan="8" style="text-align:left;background:pink;">btc</th></tr></thead> -->
<tbody style="">
<td><div></div></td>
<td><div></div></td>
<td><div></div></td>
<td><div></div></td>
<td><div></div></td>
<td><div></div></td>
<td><div></div></td>
<td><div></div></td>
</tbody>
<!-- data-typ = [init, back, ins, reset, extrem]-->
<tfoot style="background:pink;display:none;"><td colspan="8">
<input type="text" id="spanout" name="btc" value="" data-typ="init"/> 
</td>
</tfoot> 
</table>
<div style="position:absolute;right:0px;top:0px;ackground:rgba(200,0,0,0.2);width:44px;height:47px;adding:1px;">
<div id="tregDown" class="treg-down"></div>
</div>
</div>
</label>

<section id="dropBtc">
<!-- position: absolute -->
<section class="keypadInfo">info box</section>
<section class="btclab">
<label class="keypad-lbl" data-zif="0" onclick="transfer_zif(0);">0</label>
<label class="keypad-lbl" data-zif="1" onclick="transfer_zif(1);">1</label>
<label class="keypad-lbl" data-zif="2" onclick="transfer_zif(2);">2</label>
<label class="keypad-lbl" data-zif="3" onclick="transfer_zif(3);">3</label>
<label class="keypad-lbl" data-zif="4" onclick="transfer_zif(4);">4</label>
<label class="keypad-lbl" data-zif="5" onclick="transfer_zif(5);">5</label>
<label class="keypad-lbl" data-zif="6" onclick="transfer_zif(6);">6</label>
<label class="keypad-lbl" data-zif="7" onclick="transfer_zif(7);">7</label>
<label class="keypad-lbl" data-zif="8" onclick="transfer_zif(8);">8</label>
<label class="keypad-lbl" data-zif="9" onclick="transfer_zif(9);">9</label>
<label class="keypadReset" title="reset" onclick="transfer_reset(this);">clear</label>
<label class="keypad-lbl" title="point" data-zif="." onclick="transfer_zif('.');">.</label>
<label class="keypadBackspace" title="backspace" onclick="transfer_back(this);">back</label>
</section>
</section> 
</fieldset>
<input type="submit" value="ok"/>
</form>
<div>a dummy div</div>


<output id="outi"></output>
<button onclick="get_dialog();">dialog</button>
<dialog id="figa" style="visibility:hidden;">
<!-- in the old android browsers the inner html between dialog tags must to be hidden(and in IE?) -->
<h1>dialog</h1>
<button onclick="this.parentNode.close();">close</button>
</dialog>

<script>
var is_transformly=false;
var cl_del_zif = "pissoff";
var cl_ins_zif = "boo";
var cl_act_key ="act-key";
var max_cells = 8;
var spanout=gid("spanout");
spanout.textContent="";
var outi=gid("outi");
var dropBtc=gid("dropBtc");
var sik=gid("tableBtcAmount");
var backSpace=el_query(".keypadBackspace");

var backReset=el_query(".keypadReset");

var btc_maximum = 300;
var btc_minimum=0.0263;
var tdel = eltag("td");
var tdel2=eltag_to_arr(tdel);
var keypad_ev=false;
var keypad_default_btcsum=0.05;

var t_pointsign=0;
var keypad_max=false;
var keypad_min=false;
var current_number;

var back_str = "back";
var reset_str = "reset";
var ins_str = "ins";
var extrem_str = "extrem";

(function(){
if(typeof window.CustomEvent==="function")return false;
function CustomEvent(event,p){
var evt;
var pr=p || {bubbles:false,cancelable:false,detail:undefined};
evt=document.createEvent("CustomEvent");
evt.initCustomEvent(event,pr.bubbles,pr.cancelable,pr.detail);
return evt;	
}
CustomEvent.prototype=window.Event.prototype;
window.CustomEvent=CustomEvent;	
})();


function on_btc_keyboard(event){
var keyname=event.key;
if(keyname=='Control'){
console.log("Control");
return;	
}
if(event.ctrlKey){
//console.log('combination of ctrlKey ',keyname);	
}else{
if(keyname==0 || keyname==1 || keyname==2
|| keyname==3 || keyname==4 || keyname==5
|| keyname==6 || keyname==7 || keyname==8
|| keyname==9 || keyname=='.'){
transfer_zif(keyname);
}else if(keyname=='Backspace'){
transfer_back(keyname);
}else{console.log("What the fuck?",keyname);}
}	
}


function nett_zif(n){
var eli=el_query('[data-zif="'+n+'"]');
if(eli){
class_adi(eli, cl_act_key);
}
}

//document.addEventListener('keydown', on_btc_keyboard,false);

function ad_event(obj,name,funci){
obj.addEventListener(name,funci,false);
}
function rem_event(obj,name,funci){obj.removeEventListener(name,funci);}


var awevent=new CustomEvent('forinput',
 {bubbles:true, detail:{text:function(es){return es.target.value/*textContent*/;},
typ:function(es){return es.target.getAttribute("data-typ");}}});


function add_keypad_events(){
if(keypad_ev)return;
for(var i = 0; i < tdel.length; i++){
tdel[i].addEventListener('animationend', on_btc_ziffer, false);
}
spanout.addEventListener('forinput', on_forinput, false);
ad_event(document, "keydown", on_btc_keyboard);
keypad_ev=true;
}

function remove_keypad_events(){
if(!keypad_ev)return;
for(var i = 0; i < tdel.length; i++){
tdel[i].removeEventListener('animationend', on_btc_ziffer);	
}	
spanout.removeEventListener('forinput', on_forinput);
rem_event(document, "keydown", on_btc_keyboard);
keypad_ev=false;
}

function on_btc_ziffer(ev){
if(!ev.animationName){alert("ev.animationName [animationend] doesn't work in this browser?");return;}
if(ev.animationName == "example2"){
ev.target.textContent = "";
class_remove(ev.target, cl_del_zif);
class_remove(ev.target, cl_ins_zif);
class_remove(backSpace, "act");
class_remove(backReset, "act");
}else if(ev.animationName == "example"){
var el4=el_query('[data-zif="'+ev.target.textContent+'"]');
if(el4){
class_remove(el4, cl_act_key);	
}
}else{}
}

function ins_zif(text, i){
if(tdel[i] && tdel[i].firstChild){
tdel[i].className="wboo";
class_adi(tdel[i].firstChild, cl_ins_zif);
tdel[i].firstChild.textContent = text;
}
}

function change_zif(new_content, index){
if(tdel[index] && tdel[index].firstChild){
tdel[index].firstChild.textContent = new_content;
}
}

function del_all_zif(){
for(var i = 0; i < tdel.length; i++){
if(tdel[i] && tdel[i].firstChild){

if(tdel[i].firstChild.textContent){
tdel[i].className="";
if(is_transform()){
class_adi(tdel[i].firstChild, cl_del_zif);
}else{
class_remove(tdel[i].firstChild, cl_ins_zif);
tdel[i].firstChild.textContent = "";	
}
}

}}	
//captEl.style.display="initial";
}



function del_zif(index){
if(tdel[index] && tdel[index].firstChild){
	tdel[index].className="";
if(is_transform()){
class_adi(tdel[index].firstChild, cl_del_zif);
}else{
class_remove(tdel[index].firstChild, cl_ins_zif);
tdel[index].firstChild.textContent = "";	
}
}	
}



//spanout.addEventListener('forinput', on_forinput, false);



var s_d=0;

function on_forinput(ev){
console.warn("forinput: ", ev.detail.text(ev));
var word = ev.detail.text(ev);
var leni = word.length;
console.log("leni: ", leni);

var typ=ev.detail.typ(ev);
console.log("type data: ",typ);
if(typ == ins_str){
if(leni==1){placeholdi.className="empty";}else if(leni==0){placeholdi.className="";}else{}
for(var i = 0; i < leni; i++){
ins_zif(word[i], i);
}
s_d+=12;
cursi.style.left=s_d+"px";
}else if(typ == back_str){
//console.log("backspace type 'del'", leni);
del_zif(leni);
if(leni==0){placeholdi.className="";}
s_d=s_d-12;
//alert(s_d);
cursi.style.left=s_d+"px";
}else if(typ == extrem_str){
console.warn("typ: ", typ);
var cells_txt_len = get_cells_leni();
console.log("length cells: ", cells_txt_len);
for(var i = 0; i < leni; i++){
change_zif(word[i], i);
}
var len_step = cells_txt_len - leni;
var fact_len = leni+ len_step;
for(var i = leni; i < fact_len; i++){
console.warn("there is", leni," cursi: ",s_d);
if(tdel[i].firstChild.textContent) del_zif(i);
}

s_d=12*leni;
cursi.style.left=s_d+"px";
}else if(typ == reset_str){
del_all_zif();
if(leni==0)placeholdi.className="";
s_d=1;
cursi.style.left=s_d+"px";
}else{
console.warn("unknown type: ", typ);	
}
}

function get_cells_leni(){
var sc=0;
for(var i=0;i<max_cells;i++){
if(tdel[i] && tdel[i].firstChild){
if(tdel[i].firstChild.textContent){
sc++;	
}	
}	
}
return sc;	
}

function clear_act_key(){
	console.error("clear_act_key() occured!");
	//.keypad-lbl.act-key
	/*
var eli2=document.querySelectorAll(".keypad-lbl."+cl_act_key);
for(var i=0;i<eli2.length;i++){
if(eli2[i]){
if(eli2[i].classList.contains(cl_act_key))class_remove(eli2[i], cl_act_key);	
}	
}	*/
if(is_transform()){
var eli2=el_query(".keypad-lbl."+cl_act_key);
if(eli2){
class_remove(eli2, cl_act_key);	
}
}
}


function transfer_zif(el){
//console.log("here is "+el);

//ev.stopPropagation();
if(is_transform())nett_zif(el);
if(el =="."){
t_pointsign+=1;
if(keypad_max){
//clear_act_key();	
return;
}
}

if(spanout.value==btc_maximum.toString()){
console.warn("already maximum btc");
//if(!keypad_max){
clear_act_key(el);
sik.style.color="red";
//}
return;	
}
if(keypad_max || keypad_min)return;
var lenis=spanout.value.length;

if(lenis >= max_cells-1){
if(current_number < btc_minimum){
console.log("in cells less then btc minimum. Show min val");//0.05 BTC??	
set_text(spanout, btc_minimum , extrem_str);
clear_act_key(el);
sik.style.color = "green";
return;
}
}

if(lenis >= max_cells){
//alert("kuda?");
console.log("kuda?");
var fixed_num = current_number.toFixed(4);
console.log("toFixed=> ", fixed_num);
set_text(spanout, fixed_num, extrem_str);
clear_act_key(el);
sik.style.color="green";
return;
}
set_text(spanout, spanout.value + el, ins_str);
sik.style.color = "black";

var num=fetch_number(spanout.value);
console.log('num: ',num);
current_number = num;
if(isNaN(num)){
clear_act_key(el);
set_text(spanout, "", reset_str);

t_pointsign = 0;
return;	
}
if(num > btc_maximum){
keypad_max = true;
set_text(spanout, btc_maximum, extrem_str);
clear_act_key(el);
sik.style.color = "green";
}
if(num < btc_minimum){
console.warn("btc_minimum");
sik.style.color = "orange";
}
}


function transfer_back(el){
var a=spanout.value;
if(!a){console.warn("nothing to be backspaced!");alert("nothing to be backspaced!");return;}
var b=a.slice(0,-1);
if(is_transform()){
class_adi(backSpace, "act");
}
set_text(spanout, b, back_str);
keypad_max=false;
keypad_min=false;
}

function transfer_reset(el){
if(!spanout.value){alert("Nothing to reset!");return;}	
if(is_transform()){class_adi(backReset,"act");}
set_text(spanout, "", reset_str);
t_pointsign=false;
keypad_max=false;
keypad_min=false;
}

function check(){
console.log(Number(spanout.textContent))	
}
function fetch_number(str){
try{
var anum_s=Number(str);	
return anum_s;
}catch(er){alert(er);return undefined;}
}
function gid(id){
return document.getElementById(id);	
}

function eltag(td){
return dom_tagi("tableBtcAmount", td);	
}

function eltagi(str){
return document.getElementsByTagName(str);	
}

function dom_tagi(id,s){
var el_n=gid(id);
if(!el_n)return null;
var el_nu=el_n.getElementsByTagName(s);
if(!el_nu)return null;
return el_nu;	
}
function class_adi(node,clas){
if(!node){alert("wrong node el in class_adi()?");console.error("wrong node el?");return;}
if(node.classList){node.classList.add(clas);}	
}

function class_remove(node,clas){
if(!node){alert("wrong node el in class_remove()?");console.error("wrong node el?");return;}
if(!node.classList){console.error("no classList in el?");return;}
node.classList.remove(clas);
}
function bibka(){
try{
var a=document.querySelector("#dropcheck:checked");
alert(a);
}catch(e){alert(e);}	
}
function check_transform(){
var div=document.createElement("div");
div.setAttribute("style","transform:translateY(-10px);");

document.body.appendChild(div);
var ws=!!(div.style["transform"]);
alert(ws);
div.parentNode.removeChild(div);
div=null;
}

function is_transform(){
return is_transformly;
}

function is_transi(){
var div=document.createElement("div");
div.setAttribute("style","transform:translateY(-10px);");
document.body.appendChild(div);
var ws=!!(div.style["transform"]);
is_transformly=ws;
div.parentNode.removeChild(div);
div=null;
}
is_transi();
function el_query(n){
return document.querySelector(n);	
}

var super_check=false;

function nu(el){
console.log("checked ",el.checked);
//alert(1);
if(!el.checked){
console.log(el.checked);
remove_keypad_events();
dropBtc.style.display="none";	
//captEl.style.captionSide="top";
//wraptable.style.borderColor="green";
wraptable.className="";
cursi.style.display="none";
class_remove(tregDown, "act");
//super_check=false;
}else{
console.log(el.checked);
dropBtc.style.display="block";
//wraptable.style.borderColor="blue";
wraptable.className="focus";
cursi.style.display="block";
//alert(2);
//captEl.style.captionSide="bottom";
//captEl.style.display="none";
add_keypad_events();	
class_adi(tregDown,"act");
super_check=true;
//document.body.onclick=duri;
}
}

function duri(){
if(super_check){
	alert(1);
//dropcheck.checked=false;	

}	
}

function get_dialog(){
figa.style.visibility="visible";
figa.showModal();	
}
function closeg(){
	//alert(1);
gid("figa").close();
gid("figa").style.display="hidden";	
}
function eltag_to_arr(n_td){
var n_td_arr=Array.prototype.slice.apply(n_td);
return n_td_arr;	
}
function set_text(el,content, typ){
el.setAttribute("data-typ", typ);
//alert(el.getAttribute("data-typ"));
//if(el.textContent==""){
//alert("what?");
//captEl.style.display="none";
//}
//el.textContent=content;	
el.value=content;
el.dispatchEvent(awevent);
}
</script>
</body>
</html>
